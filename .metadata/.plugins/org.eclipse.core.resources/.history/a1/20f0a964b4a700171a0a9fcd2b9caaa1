//*****************************************************************************
//
// MSP432 main.c template - Empty main
//
//****************************************************************************

#include "msp.h"

#define RS BIT7
#define RW BIT6
#define E BIT5
#define DB3 BIT3 // D7
#define DB2 BIT2 // D6
#define DB1 BIT1 //D5
#define DB0 BIT0 // D4

//sends two nibbles (high and low)
void send_function()
{
    //high nibble
    P4-> OUT &= 0x10;
    delay();
    P4 -> OUT |= E; // sets enable to high (before doing anything)
    P4 -> OUT |= ((CMD >>4) & 0x0F); // shifts to low nibble, masks everything else to zero
    delay();
    P4-> &= E; //turns off E to be safe
    delay();

    P4-> OUT &= 0x10;
    delay();
    P4 -> OUT |= E; // sets enable to high (before doing anything)
    P4 -> OUT |= ((CMD >>4) & 0x0F); // shifts to low nibble, masks everything else to zero
    delay();
    P4-> &= E; //turns off E to be safe
    delay();



    // low nibble
    P4-> OUT &= 0x10;
    delay();
    P4-> OUT |= E;
    P4-> OUT |= CMD & (DB3 + DB2 + DB1 + DB0);
    delay();
    P4-> OUT & ~E;
    delay();
}


//one high, one low
//clear display and on/off
void set_command()
{
    //high nibble
    P4-> OUT &= 0x10;
    delay();
    P4 -> OUT |= E; // sets enable to high (before doing anything)
    P4 -> OUT |= ((CMD >>4) & 0x0F); // shifts to low nibble, masks everything else to zero
    delay();
    P4-> &= E; //turns off E to be safe
    delay();

    // low nibble
    P4-> OUT &= 0x10;
    delay();
    P4-> OUT |= E;
    P4-> OUT |= CMD & (DB3 + DB2 + DB1 + DB0);
    delay();
    P4-> OUT & ~E;
    delay();

}

void write_data()
{
    //high nibble
    P4-> OUT &= 0x10;
    delay();
    P4 -> OUT |= E; // sets enable to high (before doing anything)
    P4 -> OUT |= RS; // Datasheet wants RS to be high
    P4 -> OUT |= ((CMD >>4) & 0x0F); // shifts to low nibble, masks everything else to zero
    delay();
    P4-> &= E; //turns off E to be safe
    delay();

    // low nibble
    P4-> OUT &= 0x10;
    delay();
    P4-> OUT |= E;
    P4 -> OUT |= RS; // Datasheet wants RS to be high
    P4-> OUT |= CMD & (DB3 + DB2 + DB1 + DB0);
    delay();
    P4-> OUT & ~E;
    delay();
}

/* make a small delay */
void delay(void) {
    for(int i = 0; i <= 500; ++i);
}

void main(void)
{
	
    WDTCTL = WDTPW | WDTHOLD;           // Stop watchdog timer

    P4->DIR |= RS|RW|E|DB3|DB2|DB1|DB0;         /* make P4 pins output for data */


}


