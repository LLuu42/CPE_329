//*****************************************************************************
//
// MSP432 main.c template - Empty main
//
//****************************************************************************

#include "msp.h"

#define RS 1     //P4.0 mask
#define RW 2     //P4.1 mask
#define EN 4     //P4.2 mask
char location = 0x05;
/*#define 4bit 0x28   //set 4-bit data
#define shift 0x06   //shift cursor right after each char
#define clear 0x01  //clear LCD and move cursor to home
#define blink 0x0F  //turn on display, cursor blinking*/

void delayMs(int n);
void LCD_nibble_write(unsigned char data, unsigned char control);
void LCD_command(unsigned char command);
void LCD_data(unsigned char data);
void LCD_init(void);
void write_char_LCD(char location);
void LCD_init();
void Clear_LCD();

int main(void) {

    LCD_init();

    Clear_LCD();

    for(;;) {

        delayMs(1000);
        //Home_LCD();
        write_char_LCD(location);
        LCD_data('H');
        LCD_data('i');
        delayMs(1000);
    }
}

void LCD_init(void) {
    P4->DIR = 0xFF;
    delayMs(30);
    LCD_nibble_write(0x30, 0);
    delayMs(10);
    LCD_nibble_write(0x30, 0);
    delayMs(1);
    LCD_nibble_write(0x30, 0);
    delayMs(1);
    LCD_nibble_write(0x20, 0);
    delayMs(1);

    LCD_command(0x28);
    LCD_command(0x06);
    LCD_command(0x01);
    LCD_command(0x0F);
}

void LCD_nibble_write(unsigned char data, unsigned char control) {
   // data &= 0xF0;
    //control &= 0x0F;
    P4->OUT = data | control;
    P4->OUT = data | control | EN;
    delayMs(0);
   P4->OUT = data;
    P4->OUT = 0;
}

void LCD_command(unsigned char command) {
    LCD_nibble_write(command & 0xF0, 0);
    LCD_nibble_write(command << 4, 0);

    if (command < 4)
        delayMs(4);
    else
        delayMs(1);
}

void LCD_data(unsigned char data) {
    LCD_nibble_write(data & 0xF0, RS);
    LCD_nibble_write(data <<4, RS);

    delayMs(1);
}

void delayMs(int n) {
    int i, j;
    for (j = 0; j < n; j++)
        for (i = 160; i > 0; i--);   // delay 1 ms (approx)
}

void Clear_LCD() {
    LCD_command(0x01);      //Set DB0 to be 1    clears
}
void Home_LCD() {
    LCD_command(0x02);      //Set DB1 to be 1    sets cursor to top left
}

void write_char_LCD(char location) {

    LCD_command(0x80 | location);      //set DDRAM with lower hex bit
}
